@page "/employees"

<div class="employees-page">
    <div class="header">
        <h1>Employee Management</h1>
        <button class="btn-primary" @onclick="ShowCreateForm">Add Employee</button>
    </div>

    @if (!string.IsNullOrEmpty(ErrorMessage))
    {
        <div class="error-message">
            @ErrorMessage
        </div>
    }

    <div class="filters">
        <div class="search-bar">
            <input type="text"
                   placeholder="Search by name or email"
                   @bind="SearchTerm" />
        </div>

        <div class="filter-controls">
            <select @bind="SelectedDepartment">
                <option value="">All Departments</option>
                @foreach (var department in GetDepartmentOptions())
                {
                    <option value="@department">@department</option>
                }
            </select>

            <select @bind="SelectedContractType">
                <option value="">All Contract Types</option>
                @foreach (var type in GetContractTypeOptions())
                {
                    <option value="@type">@type</option>
                }
            </select>

            <button class="btn-secondary" @onclick="ResetFilters">Reset Filters</button>
        </div>
    </div>

    <div class="employees-list">
        @if (OurEmployees == null)
        {
            <p>Loading...</p>
        }
        else if (!FilteredEmployees.Any())
        {
            <p>No employees found.</p>
        }
        else
        {
            <table>
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Department</th>
                    <th>Contract</th>
                    <th>Salary</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                @foreach (var employee in FilteredEmployees)
                {
                    <tr>
                        <td>@employee.FullName</td>
                        <td>@employee.Department</td>
                        <td>@employee.ContractType</td>
                        <td>@FormatSalary(employee.Salary)</td>
                        <td class="actions">
                            <button class="btn-edit" @onclick="() => ShowEditFormAsync(employee)">Edit</button>
                            <button class="btn-delete" @onclick="() => DeleteEmployeeAsync(employee)">Delete</button>
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        }
    </div>

    @if (ShowCreate)
    {
        <div class="modal">
            <div class="modal-content">
                <h2>Add New Employee</h2>
                <div class="form-group">
                    <input placeholder="First Name" @bind="FirstName" @bind:event="oninput" />
                    <input placeholder="Last Name" @bind="LastName" @bind:event="oninput" />
                    <input placeholder="Email" type="email" @bind="Email" @bind:event="oninput" />

                    <select @bind="Department" @bind:event="onchange">
                        @foreach (var dept in GetDepartmentOptions())
                        {
                            <option value="@dept">@dept</option>
                        }
                    </select>

                    <select @bind="ContractType" @bind:event="onchange">
                        @foreach (var type in GetContractTypeOptions())
                        {
                            <option value="@type">@type</option>
                        }
                    </select>

                    <input placeholder="Salary" type="number" step="0.01" @bind="Salary" @bind:event="oninput" />

                    <select @bind="Gender" @bind:event="onchange">
                        @foreach (var gender in GetGenderOptions())
                        {
                            <option value="@gender">@gender</option>
                        }
                    </select>
                </div>

                <div class="modal-actions">
                    <button class="btn-secondary" @onclick="() => ShowCreate = false">Cancel</button>
                    <button class="btn-primary" @onclick="CreateNewEmployeeAsync">Create</button>
                </div>
            </div>
        </div>
    }

    @if (ShowEdit)
    {
        <div class="modal">
            <div class="modal-content">
                <h2>Edit Employee</h2>
                <div class="form-group">
                    <input placeholder="First Name" @bind="EditFirstName" @bind:event="oninput" />
                    <input placeholder="Last Name" @bind="EditLastName" @bind:event="oninput" />
                    <input placeholder="Email" type="email" @bind="EditEmail" @bind:event="oninput" />

                    <select @bind="EditDepartment" @bind:event="onchange">
                        @foreach (var dept in GetDepartmentOptions())
                        {
                            <option value="@dept">@dept</option>
                        }
                    </select>

                    <select @bind="EditContractType" @bind:event="onchange">
                        @foreach (var type in GetContractTypeOptions())
                        {
                            <option value="@type">@type</option>
                        }
                    </select>

                    <input placeholder="Salary" type="number" step="0.01" @bind="EditSalary" @bind:event="oninput" />

                    <select @bind="EditGender" @bind:event="onchange">
                        @foreach (var gender in GetGenderOptions())
                        {
                            <option value="@gender">@gender</option>
                        }
                    </select>
                </div>

                <div class="modal-actions">
                    <button class="btn-secondary" @onclick="CancelEdit">Cancel</button>
                    <button class="btn-primary" @onclick="UpdateEmployeeAsync">Update</button>
                </div>
            </div>
        </div>
    }
</div>