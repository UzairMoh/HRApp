@page "/employees"
@attribute [Authorize(Roles = "Admin")]

<PageTitle>Employees</PageTitle>

<div class="dashboard-container">
    <div class="dashboard-header">
        <div class="header-title">
            <h1>Employee Management</h1>
            <button class="btn btn-primary" @onclick="ShowCreateForm">
                <i class="fas fa-plus"></i> Add Employee
            </button>
        </div>

        <div class="filters-section">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input
                    class="search-input"
                    type="text"
                    placeholder="Search employees..."
                    @oninput="(e) => FilterEmployees(e.Value!.ToString()!)"
                >
            </div>

            <div class="filter-group">
                <select class="filter-select" @onchange="(e) => FilterByDepartment(e.Value!.ToString()!)">
                    <option value="">All Departments</option>
                    <option value="Engineering">Engineering</option>
                    <option value="Accounting">Accounting</option>
                    <option value="Product Management">Product Management</option>
                    <option value="Human Resources">Human Resources</option>
                    <option value="Legal">Legal</option>
                </select>

                <select class="filter-select" @onchange="(e) => FilterByGender(e.Value!.ToString()!)">
                    <option value="">All Genders</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
            </div>
        </div>
    </div>

    @if (ShowCreate)
    {
        <div class="card">
            <div class="card-header">
                <h2>New Employee</h2>
            </div>
            <div class="card-body">
                <EditForm Model="@this" OnValidSubmit="@CreateNewEmployeeAsync">
                    <DataAnnotationsValidator />
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="firstName">First Name</label>
                            <InputText id="firstName" @bind-Value="FirstName" class="form-input" />
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last Name</label>
                            <InputText id="lastName" @bind-Value="LastName" class="form-input" />
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <InputText id="email" @bind-Value="Email" class="form-input" />
                        </div>
                        <div class="form-group">
                            <label for="gender">Gender</label>
                            <InputSelect id="gender" @bind-Value="Gender" class="form-input">
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </InputSelect>
                        </div>
                        <div class="form-group">
                            <label for="department">Department</label>
                            <InputSelect id="department" @bind-Value="Department" class="form-input">
                                <option value="">Select Department</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Accounting">Accounting</option>
                                <option value="Product Management">Product Management</option>
                                <option value="Human Resources">Human Resources</option>
                                <option value="Legal">Legal</option>
                            </InputSelect>
                        </div>
                        <div class="form-group">
                            <label for="employeeType">Employee Type</label>
                            <InputSelect id="employeeType" @bind-Value="EmployeeType" class="form-input">
                                @foreach (var type in GetEmployeeTypes())
                                {
                                    <option value="@type">@type</option>
                                }
                            </InputSelect>
                        </div>
                        <div class="form-group">
                            <label for="salary">Salary</label>
                            <InputText id="salary" @bind-Value="Salary" class="form-input" />
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" @onclick="() => ShowCreate = false">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Employee</button>
                    </div>
                </EditForm>
            </div>
        </div>
    }

    @if (FilteredEmployees.Count > 0)
    {
        <div class="employee-cards">
            @foreach (var employee in FilteredEmployees)
            {
                <div class="employee-card @(ShowEdit && EditingId == employee.Id ? "editing" : "")">
                    @if (ShowEdit && EditingId == employee.Id)
                    {
                        <div class="card-edit-form">
                            <h3>Edit Employee</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>First Name</label>
                                    <InputText @bind-Value="EditFirstName" class="form-input" />
                                </div>
                                <div class="form-group">
                                    <label>Last Name</label>
                                    <InputText @bind-Value="EditLastName" class="form-input" />
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <InputText @bind-Value="EditEmail" class="form-input" />
                                </div>
                                <div class="form-group">
                                    <label>Employee Type</label>
                                    <InputSelect @bind-Value="EditEmployeeType" class="form-input">
                                        @foreach (var type in GetEmployeeTypes())
                                        {
                                            <option value="@type">@type</option>
                                        }
                                    </InputSelect>
                                </div>
                                <div class="form-group">
                                    <label>Department</label>
                                    <InputSelect @bind-Value="EditDepartment" class="form-input">
                                        <option value="Engineering">Engineering</option>
                                        <option value="Accounting">Accounting</option>
                                        <option value="Product Management">Product Management</option>
                                        <option value="Human Resources">Human Resources</option>
                                        <option value="Legal">Legal</option>
                                    </InputSelect>
                                </div>
                                <div class="form-group">
                                    <label>Salary</label>
                                    <InputText @bind-Value="EditSalary" class="form-input" />
                                </div>
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-secondary" @onclick="CancelEdit">Cancel</button>
                                <button class="btn btn-primary" @onclick="UpdateEmployeeAsync">Save Changes</button>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="card-header">
                            <div class="employee-name">@employee.FirstName @employee.LastName</div>
                            <div class="employee-type">@employee.EmployeeType</div>
                        </div>
                        <div class="card-body">
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="label">Email</span>
                                    <span class="value">@employee.Email</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Department</span>
                                    <span class="value">@employee.Department</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Contract Type</span>
                                    <span class="value">@employee.ContractType</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Benefits</span>
                                    <span class="value">@employee.BenefitsPackage</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Working Hours</span>
                                    <span class="value">@employee.WorkingHoursPerWeek hrs/week</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Salary</span>
                                    <span class="value">@employee.Salary</span>
                                </div>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-secondary" @onclick="() => ShowEditFormAsync(employee)">Edit</button>
                            <button class="btn btn-danger" @onclick="() => DeleteEmployeeAsync(employee)">Delete</button>
                        </div>
                    }
                </div>
            }
        </div>
    }
    else
    {
        <div class="empty-state">
            <i class="fas fa-users"></i>
            <p>No employees found</p>
            <button class="btn btn-primary" @onclick="ShowCreateForm">Add Your First Employee</button>
        </div>
    }
</div>